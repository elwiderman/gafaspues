(()=>{"use strict";var e={};function t(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e){return i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i(e)}function n(e){var t=function(e,t){if("object"!=i(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var o=n.call(e,t||"default");if("object"!=i(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==i(t)?t:t+""}function o(e,t){for(var i=0;i<t.length;i++){var o=t[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,n(o.key),o)}}function a(e,t,i){return t&&o(e.prototype,t),i&&o(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}function s(e,t,i){return(t=n(t))in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}const r={xhr:!1,block:function(e){e&&e.length&&void 0!==jQuery.fn.block&&(e.addClass("ajax-blocked"),e.block({message:null,overlayCSS:{background:"#fff no-repeat center",opacity:.5,cursor:"none"}}))},unblock:function(e){e&&e.hasClass("ajax-blocked")&&void 0!==jQuery.fn.block&&(e.unblock(),e.removeClass("ajax-blocked"))},call:function(e,t,i){var n=this;return i=void 0!==i?i:"GET",Array.isArray(e)?(e.push({name:"action",value:yith_wcmv_ajax.ajaxAction}),e.push({name:"security",value:yith_wcmv_ajax.ajaxNonce}),e.push({name:"context",value:"admin"})):(e.action=yith_wcmv_ajax.ajaxAction,e.security=yith_wcmv_ajax.ajaxNonce,e.context="admin"),n.block(t),n.xhr=jQuery.ajax({url:yith_wcmv_ajax.ajaxUrl,data:e,type:i}).fail((function(e){console.log(e),n.unblock(t)})).done((function(e){n.unblock(t),n.xhr=!1})),n.xhr},get:function(e,t){return this.call(e,t,"GET")},post:function(e,t){return this.call(e,t,"POST")},abort:function(){this.xhr&&this.xhr.abort()}};var l=function(){return a((function e(i){t(this,e),s(this,"container",null),this.container=i}),[{key:"init",value:function(){if(!this.container.length)return!1;jQuery(document).trigger("yith_fields_init"),jQuery(document.body).trigger("yith-plugin-fw-init-radio"),jQuery(document).trigger("yith-add-box-button-toggle"),this.initValue(),this.initEnhancedSelect(),this.initTinyMCE(),this.container.on("change",".field-required",{self:this},this.listenRequired),this.container.on("change",".email-validate",{self:this},this.validateEmail),this.container.closest("form").on("submit",this.checkFormErrors.bind(this))}},{key:"initTinyMCE",value:function(){"undefined"!=typeof tinyMCE&&"undefined"!=typeof tinyMCEPreInit&&this.container.find(".editor textarea").each((function(){var e=jQuery(this).attr("id"),t=tinyMCEPreInit.mceInit,i=Object.keys(t)[0],n=t[i],o=tinyMCEPreInit.qtInit,a=t[Object.keys(o)[0]];n.selector=e,n.body_class=n.body_class.replace(i,e),a.id=e,tinyMCE.init(n),tinyMCE.execCommand("mceRemoveEditor",!0,e),tinyMCE.execCommand("mceAddEditor",!0,e),quicktags(a),QTags._buttonsInit()}))}},{key:"initValue",value:function(){this.container.find(":input").each((function(){var e,t=jQuery(this),i=null!==(e=t.data("value"))&&void 0!==e?e:null;if(!t.is(":radio")&&"hidden"!==t.attr("type")&&null!==i)if(t.is(":checkbox")){var n=t.is(":checked");(!n&&"yes"===i||n&&"yes"!==i)&&t.click()}else t.val(i)}))}},{key:"initEnhancedSelect",value:function(){if("undefined"==typeof yith_wcmv_ajax||void 0===jQuery.fn.selectWoo)return!1;this.container.find("select.yith-wcmv-ajax-search").filter(":not(.initialized)").each((function(){var e,t=jQuery(this),i=null!==(e=t.data("value"))&&void 0!==e?e:null;if(null!==i)for(var n in i)t.append(new Option(i[n],n,!0,!0));t.trigger("change"),t.selectWoo({allowClear:!0,placeholder:jQuery(this).data("placeholder"),minimumInputLength:"3",escapeMarkup:function(e){return e},ajax:{url:yith_wcmv_ajax.ajaxUrl,dataType:"json",delay:1e3,data:function(e){return{term:e.term,request:jQuery(this).data("action"),action:yith_wcmv_ajax.ajaxAction,security:yith_wcmv_ajax.ajaxNonce,context:"admin"}},processResults:function(e){var t=[];return e.success&&jQuery.each(e.data,(function(e,i){t.push({id:e,text:i})})),{results:t}},cache:!0}}).addClass("initialized").on("select2:select",(function(e){t.find("option.value-placeholder").remove()})).on("select2:unselect",(function(e){var i=e.params.data.id;t.find('option[value="'+i+'"]').remove(),t.find("option").length||t.append('<option value="" class="value-placeholder"></option>')}))})),this.container.find("select").filter(":not(.initialized)").each((function(){var e,t=jQuery(this),i=null!==(e=t.data("value"))&&void 0!==e?e:null,n=jQuery(this).find("option").filter('[value=""]'),o={minimumResultsForSearch:20};n.length&&(o.placeholder={id:"",text:n.text()},o.allowClear=!0),null!==i&&(i+="",t.val(i.split(",")).change()),t.selectWoo(o).addClass("initialized")}))}},{key:"isValidEmail",value:function(e){return e.toLowerCase().match(/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/)}},{key:"validateEmail",value:function(e){var t,i=e.data.self,n=jQuery(this),o=n.val();o&&!i.isValidEmail(o)?i.addFieldError(null===(t=yith_vendors)||void 0===t?void 0:t.emailFieldError,n.attr("name")):i.resetFieldError(n.attr("name"))}},{key:"addFormError",value:function(e,t){t.prepend('<div id="error-message">'+e+"</div>")}},{key:"addFieldError",value:function(e,t,i){i&&i.length||(i=this.container);var n=i.find('[name="'+t+'"]');n.length||this.addFormError(e,i);var o=n.next(".error-msg");n.addClass("field-error"),o.length?o.html(e):n.after('<span class="error-msg">'+e+"</span>")}},{key:"resetFormError",value:function(e){var t=this;e&&e.length||(e=this.container),e.find("#error-message").remove(),e.find(".field-error").each((function(e,i){t.resetFieldError(jQuery(i).attr("name"))}))}},{key:"resetFieldError",value:function(e){if(e&&this.container.find('[name="'+e+'"]')){var t=this.container.find('[name="'+e+'"]');t.removeClass("field-error"),t.next(".error-msg").remove()}}},{key:"listenRequired",value:function(e){var t,i=e.data.self,n=jQuery(this),o=n.attr("name");n.val()?n.hasClass("ajax-check")||i.resetFieldError(o):i.addFieldError(null===(t=yith_vendors)||void 0===t?void 0:t.requiredFieldError,o)}},{key:"isFormWithErrors",value:function(){var e=this.container.closest("form");return e.find(":input").filter(".field-required").trigger("change"),!!e.find("#error-message, .field-error").length}},{key:"checkFormErrors",value:function(e){this.isFormWithErrors()&&(e.preventDefault(),jQuery("html").animate({scrollTop:this.container.find("#error-message, .field-error").first().offset().top-100},1e3))}}])}(),d=(new(function(){return a((function e(){t(this,e),s(this,"zoneTable",void 0),s(this,"zoneAdd",void 0),s(this,"zoneList",void 0),s(this,"zoneListEmpty",void 0),s(this,"buttonAdd",void 0),s(this,"methodModal",void 0),s(this,"methodModalTrigger",void 0),this.zoneTable=jQuery("#yith-wcmv-shipping-zones-wrapper"),this.zoneAdd=this.zoneTable.find(".yith-wcmv-shipping-zone-new"),this.zoneList=this.zoneTable.find(".yith-wcmv-shipping-zones"),this.zoneListEmpty=this.zoneTable.find(".yith-wcmv-shipping-zones-empty"),this.buttonAdd=this.zoneTable.find(".yith-wcmv-shipping-zones-add-button"),this.methodModal=null,this.methodModalTrigger=null,this.init()}),[{key:"init",value:function(){if(!this.zoneTable.length||"undefined"==typeof yith_wcmv_shipping_general)return!1;this._initSelect(),this._initSortable(),this.zoneTable.on("click",".yith-wcmv-shipping-zone-select-action",this.selectRegionsActions),this.zoneTable.on("click",".yith-wcmv-shipping-zone-postcodes-toggle",this.showRegionsPostcode),this.zoneTable.on("yith-wcmv-shipping-list-updated",this.handleListUpdate.bind(this)),this.buttonAdd.on("click",this.addZone.bind(this)),this.zoneTable.on("click",".edit-zone a",{self:this},this.editZone),this.zoneTable.on("click",".trash-zone a",{self:this},this.deleteZone),this.zoneTable.on("click",".save-zone",{self:this},this.saveZone),this.zoneTable.on("click",".yith-wcmv-shipping-zone-settings__method-add",{self:this},this.addMethod),this.zoneTable.on("click",".edit-method a",{self:this},this.editMethod),this.zoneTable.on("click",".trash-method a",{self:this},this.deleteMethod),jQuery(document).on("submit",".yith-wcmv-shipping-method-modal form",{self:this},this.modalSubmit)}},{key:"_zoneListIsEmpty",value:function(){return!this.zoneList.children().length}},{key:"_switchButtonAdd",value:function(e){e?this.buttonAdd.addClass("button-secondary").removeClass("button-primary").text(this.buttonAdd.data("closed_label")):this.buttonAdd.addClass("button-primary").removeClass("button-secondary").text(this.buttonAdd.data("opened_label"))}},{key:"_initSelect",value:function(e){if(void 0===jQuery.fn.selectWoo)return!1;void 0===e&&(e=this.zoneTable),jQuery(e).find("select:not(.initialized)").each((function(){var e,t={minimumResultsForSearch:20},i=null!==(e=jQuery(this).data("value"))&&void 0!==e?e:null;jQuery(this).hasClass("yith-wcmv-shipping-zone-region-select")&&(t.data=yith_wcmv_shipping_general.shippingRegions,t.escapeMarkup=function(e){return e}),jQuery(this).selectWoo(t).addClass("initialized"),i&&jQuery(this).val(i).change()}))}},{key:"_initSortable",value:function(){var e=this,t=this.zoneList.find(".yith-wcmv-shipping-zone"),i=this.zoneList.hasClass("ui-sortable");t.length>1&&(i?this.zoneList.sortable("refresh"):this.zoneList.sortable({handle:".drag-zone",cursor:"move",scrollSensitivity:10,tolerance:"pointer",axis:"y",stop:function(t,i){var n=[];e.zoneList.find(".yith-wcmv-shipping-zone").each((function(){n.push(jQuery(this).data("zone_id"))})),r.post({request:yith_wcmv_shipping_general.orderZonesAction,order:n})}}))}},{key:"handleListUpdate",value:function(){this._zoneListIsEmpty()?this.zoneListEmpty.show():this.zoneListEmpty.hide(),this._initSelect(),this._initSortable()}},{key:"showRegionsPostcode",value:function(e){e.preventDefault(),e.stopImmediatePropagation(),jQuery(this).siblings(".yith-wcmv-shipping-zone-postcodes").toggle()}},{key:"selectRegionsActions",value:function(e){e.preventDefault(),e.stopImmediatePropagation();var t=jQuery(this).data("action"),i=jQuery(this).closest(".yith-wcmv-shipping-zone-settings__field").find(".yith-wcmv-shipping-zone-region-select");"remove-all"===t?i.val("").change():"select-all"===t&&i.val("continent:all").change()}},{key:"addZone",value:function(e){var t=this;e.preventDefault(),e.stopImmediatePropagation();var i=wp.template("yith-wcmv-shipping-zones-new");this.zoneAdd.is(":visible")?(this._switchButtonAdd(!1),this.zoneAdd.slideToggle("400",(function(){t.zoneAdd.html("")}))):(this._switchButtonAdd(!0),this.zoneAdd.html(i({})),this._initSelect(),this.zoneAdd.slideToggle())}},{key:"editZone",value:function(e){e.preventDefault();var t=jQuery(this).closest(".yith-wcmv-shipping-zone");t.toggleClass("editing"),t.siblings(".editing").length||e.data.self.zoneList.toggleClass("sortable-disabled"),t.find(".yith-wcmv-shipping-zone-settings").slideToggle()}},{key:"deleteZone",value:function(e){e.preventDefault(),e.stopImmediatePropagation();var t=e.data.self,i=jQuery(this).closest(".yith-wcmv-shipping-zone"),n=i.data("zone_id");yith.ui.confirm({title:yith_wcmv_shipping_general.removeZoneTitle,message:yith_wcmv_shipping_general.removeZoneMessage,confirmButtonType:"delete",confirmButton:yith_wcmv_shipping_general.removeButtonLabel,closeAfterConfirm:!0,onConfirm:function(){i.remove(),t.zoneTable.trigger("yith-wcmv-shipping-list-updated"),r.post({request:yith_wcmv_shipping_general.removeZoneAction,zone_id:n})}})}},{key:"saveZone",value:function(e){e.preventDefault(),e.stopImmediatePropagation();var t=e.data.self,i=jQuery(this).closest(".yith-wcmv-shipping-zone, .yith-wcmv-shipping-zone-new"),n=i.data("zone_id"),o=i.find(":input").serializeArray().filter((function(e){return e.value.length}));if(!o.length)return!1;o.push({name:"request",value:yith_wcmv_shipping_general.saveZoneAction},{name:"zone_id",value:n}),r.post(o,i).done((function(e){var i;if(null!=e&&e.success&&null!=e&&null!==(i=e.data)&&void 0!==i&&i.html){var n,o=t.zoneTable.find('.yith-wcmv-shipping-zone[data-zone_id="'+(null==e||null===(n=e.data)||void 0===n?void 0:n.zone_id)+'"]');o.length?o.replaceWith(e.data.html):(t._switchButtonAdd(!1),t.zoneAdd.html("").hide(),t.zoneList.append(e.data.html)),t.zoneTable.trigger("yith-wcmv-shipping-list-updated")}}))}},{key:"openModal",value:function(e,t,i){this.methodModal=yith.ui.modal({width:null!=i?i:500,classes:{wrap:"yith-wcmv-shipping-method-modal",content:"yith-plugin-ui"},title:e,content:t,onCreate:function(){new l(jQuery(".yith-wcmv-shipping-method-modal")).init()}})}},{key:"addMethod",value:function(e){e.preventDefault(),e.stopImmediatePropagation();var t=e.data.self,i=wp.template("yith-wcmv-shipping-zones-new-method");t.openModal(yith_wcmv_shipping_general.shippingMethodTitle,i({zone_id:jQuery(this).data("zone_id")}))}},{key:"editMethod",value:function(e){e.preventDefault(),e.stopImmediatePropagation();var t=e.data.self,i=jQuery(this).parent(),n=i.attr("data-method_id"),o=wp.template("yith-wcmv-shipping-zones-settings-method"),a=JSON.parse(jQuery("#yith-wcmv-shipping-method-data-"+n).val());a.zone_id=i.attr("data-zone_id"),a.method_id=n,t.openModal(yith_wcmv_shipping_general.shippingEditMethodTitle.replace("{{method_title}}",a.method_title),o(a),600)}},{key:"deleteMethod",value:function(e){e.preventDefault(),e.stopImmediatePropagation();var t=jQuery(this).closest(".yith-wcmv-shipping-zone-settings__method"),i=jQuery(this).parent(),n=i.attr("data-method_id"),o=i.attr("data-zone_id");yith.ui.confirm({title:yith_wcmv_shipping_general.removeMethodTitle,message:yith_wcmv_shipping_general.removeMethodMessage,confirmButtonType:"delete",confirmButton:yith_wcmv_shipping_general.removeButtonLabel,closeAfterConfirm:!0,onConfirm:function(){t.remove(),r.post({request:yith_wcmv_shipping_general.removeShippingMethod,method_id:n,zone_id:o})}})}},{key:"modalSubmit",value:function(e){e.preventDefault(),e.stopImmediatePropagation();var t=e.data.self,i=jQuery(this).serializeArray();r.post(i,jQuery(".yith-plugin-fw__modal__main")).done((function(e){var i;if(null!=e&&e.success&&null!=e&&null!==(i=e.data)&&void 0!==i&&i.html){var n,o,a=t.zoneTable.find('.yith-wcmv-shipping-zone[data-zone_id="'+(null==e||null===(n=e.data)||void 0===n?void 0:n.zone_id)+'"]');!a.length&&t.zoneAdd.is(":visible")&&(a=t.zoneAdd);var s=a.find('.yith-wcmv-shipping-zone-settings__method[data-method_id="'+(null==e||null===(o=e.data)||void 0===o?void 0:o.method_id)+'"]');s.length?s.replaceWith(e.data.html):a.find(".yith-wcmv-shipping-zone-settings__methods ul").prepend(e.data.html),t.methodModal.close()}}))}}])}()),window);for(var h in e)d[h]=e[h];e.__esModule&&Object.defineProperty(d,"__esModule",{value:!0})})();
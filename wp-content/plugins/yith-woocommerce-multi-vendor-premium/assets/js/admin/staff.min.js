(()=>{"use strict";var e={};function t(e){return t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},t(e)}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e){var i=function(e,i){if("object"!=t(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,i||"default");if("object"!=t(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===i?String:Number)(e)}(e,"string");return"symbol"==t(i)?i:i+""}function r(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,n(r.key),r)}}function a(e,t,i){return t&&r(e.prototype,t),i&&r(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}var o=function(){return a((function e(t){var r,a,o;i(this,e),r=this,o=null,(a=n(a="container"))in r?Object.defineProperty(r,a,{value:o,enumerable:!0,configurable:!0,writable:!0}):r[a]=o,this.container=t}),[{key:"init",value:function(){if(!this.container.length)return!1;jQuery(document).trigger("yith_fields_init"),jQuery(document.body).trigger("yith-plugin-fw-init-radio"),jQuery(document).trigger("yith-add-box-button-toggle"),this.initValue(),this.initEnhancedSelect(),this.initTinyMCE(),this.container.on("change",".field-required",{self:this},this.listenRequired),this.container.on("change",".email-validate",{self:this},this.validateEmail),this.container.closest("form").on("submit",this.checkFormErrors.bind(this))}},{key:"initTinyMCE",value:function(){"undefined"!=typeof tinyMCE&&"undefined"!=typeof tinyMCEPreInit&&this.container.find(".editor textarea").each((function(){var e=jQuery(this).attr("id"),t=tinyMCEPreInit.mceInit,i=Object.keys(t)[0],n=t[i],r=tinyMCEPreInit.qtInit,a=t[Object.keys(r)[0]];n.selector=e,n.body_class=n.body_class.replace(i,e),a.id=e,tinyMCE.init(n),tinyMCE.execCommand("mceRemoveEditor",!0,e),tinyMCE.execCommand("mceAddEditor",!0,e),quicktags(a),QTags._buttonsInit()}))}},{key:"initValue",value:function(){this.container.find(":input").each((function(){var e,t=jQuery(this),i=null!==(e=t.data("value"))&&void 0!==e?e:null;if(!t.is(":radio")&&"hidden"!==t.attr("type")&&null!==i)if(t.is(":checkbox")){var n=t.is(":checked");(!n&&"yes"===i||n&&"yes"!==i)&&t.click()}else t.val(i)}))}},{key:"initEnhancedSelect",value:function(){if("undefined"==typeof yith_wcmv_ajax||void 0===jQuery.fn.selectWoo)return!1;this.container.find("select.yith-wcmv-ajax-search").filter(":not(.initialized)").each((function(){var e,t=jQuery(this),i=null!==(e=t.data("value"))&&void 0!==e?e:null;if(null!==i)for(var n in i)t.append(new Option(i[n],n,!0,!0));t.trigger("change"),t.selectWoo({allowClear:!0,placeholder:jQuery(this).data("placeholder"),minimumInputLength:"3",escapeMarkup:function(e){return e},ajax:{url:yith_wcmv_ajax.ajaxUrl,dataType:"json",delay:1e3,data:function(e){return{term:e.term,request:jQuery(this).data("action"),action:yith_wcmv_ajax.ajaxAction,security:yith_wcmv_ajax.ajaxNonce,context:"admin"}},processResults:function(e){var t=[];return e.success&&jQuery.each(e.data,(function(e,i){t.push({id:e,text:i})})),{results:t}},cache:!0}}).addClass("initialized").on("select2:select",(function(e){t.find("option.value-placeholder").remove()})).on("select2:unselect",(function(e){var i=e.params.data.id;t.find('option[value="'+i+'"]').remove(),t.find("option").length||t.append('<option value="" class="value-placeholder"></option>')}))})),this.container.find("select").filter(":not(.initialized)").each((function(){var e,t=jQuery(this),i=null!==(e=t.data("value"))&&void 0!==e?e:null,n=jQuery(this).find("option").filter('[value=""]'),r={minimumResultsForSearch:20};n.length&&(r.placeholder={id:"",text:n.text()},r.allowClear=!0),null!==i&&(i+="",t.val(i.split(",")).change()),t.selectWoo(r).addClass("initialized")}))}},{key:"isValidEmail",value:function(e){return e.toLowerCase().match(/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/)}},{key:"validateEmail",value:function(e){var t,i=e.data.self,n=jQuery(this),r=n.val();r&&!i.isValidEmail(r)?i.addFieldError(null===(t=yith_vendors)||void 0===t?void 0:t.emailFieldError,n.attr("name")):i.resetFieldError(n.attr("name"))}},{key:"addFormError",value:function(e,t){t.prepend('<div id="error-message">'+e+"</div>")}},{key:"addFieldError",value:function(e,t,i){i&&i.length||(i=this.container);var n=i.find('[name="'+t+'"]');n.length||this.addFormError(e,i);var r=n.next(".error-msg");n.addClass("field-error"),r.length?r.html(e):n.after('<span class="error-msg">'+e+"</span>")}},{key:"resetFormError",value:function(e){var t=this;e&&e.length||(e=this.container),e.find("#error-message").remove(),e.find(".field-error").each((function(e,i){t.resetFieldError(jQuery(i).attr("name"))}))}},{key:"resetFieldError",value:function(e){if(e&&this.container.find('[name="'+e+'"]')){var t=this.container.find('[name="'+e+'"]');t.removeClass("field-error"),t.next(".error-msg").remove()}}},{key:"listenRequired",value:function(e){var t,i=e.data.self,n=jQuery(this),r=n.attr("name");n.val()?n.hasClass("ajax-check")||i.resetFieldError(r):i.addFieldError(null===(t=yith_vendors)||void 0===t?void 0:t.requiredFieldError,r)}},{key:"isFormWithErrors",value:function(){var e=this.container.closest("form");return e.find(":input").filter(".field-required").trigger("change"),!!e.find("#error-message, .field-error").length}},{key:"checkFormErrors",value:function(e){this.isFormWithErrors()&&(e.preventDefault(),jQuery("html").animate({scrollTop:this.container.find("#error-message, .field-error").first().offset().top-100},1e3))}}])}(),l=(new(function(){return a((function e(){i(this,e),"undefined"!=typeof yith_wcmv_staff&&this.init()}),[{key:"init",value:function(){this.addHeadingCreateButton(),jQuery(document).on("click","a.add-staff",this.create.bind(this)),jQuery(document).on("click",".edit-staff-permissions",{self:this},this.editPermission),jQuery(document).on("yith_wcmv_vendors_modal_opened",this.vendorsModalOpened)}},{key:"addHeadingCreateButton",value:function(){var e;null===(e=jQuery("#yith_wpv_panel_staff").find(".yith-plugin-fw__panel__content__page__title"))||void 0===e||e.after(jQuery("<a>",{href:"#",class:"add-staff yith-add-button",text:yith_wcmv_staff.addStaffButtonLabel}))}},{key:"openModal",value:function(e,t){yith.ui.modal({width:500,classes:{wrap:"staff-modal",content:"yith-plugin-ui"},title:e,content:t,footer:"",onCreate:function(){var e=jQuery(".staff-modal form"),t=new o(e.find(".form-table"));t.init(),void 0!==jQuery.fn.block&&e.on("submit",(function(){t.isFormWithErrors()||e.block({message:null,overlayCSS:{background:"#fff no-repeat center",opacity:.5,cursor:"none"}})}))}})}},{key:"create",value:function(e){e.preventDefault();var t=wp.template("yith-wcmv-modal-new-staff");void 0!==t&&this.openModal(yith_wcmv_staff.addStaffTitle,t())}},{key:"editPermission",value:function(e){var t;e.preventDefault();var i=jQuery(this).closest("tr"),n=i.data("id"),r=null!==(t=i.data("permissions"))&&void 0!==t?t:{},a=wp.template("yith-wcmv-modal-edit-staff-permissions");r=jQuery.extend({},yith_wcmv_staff.permissionsStaffDefault,r),void 0!==a&&e.data.self.openModal(yith_wcmv_staff.editPermissionsStaffTitle,a({id:n,permissions:r}))}},{key:"vendorsModalOpened",value:function(e,i,n){if("create"===n)null==i||i.elements.title.find('li[data-step="staff"]').remove(),null==i||i.elements.content.find('fieldset[data-step="staff"]').remove();else{var r=null==i?void 0:i.elements.content.find(".staff-list-wrapper"),a=null==r?void 0:r.data("staff");if("object"===t(a)&&Object.keys(a).length){var o="";jQuery.each(a,(function(e,t){o+='<div class="staff-single">{{name}} - <a href="mailto:{{email}}">{{email}}</a></div>'.replace("{{name}}",t).replaceAll("{{email}}",e)})),r.html(o)}}}}])}()),window);for(var s in e)l[s]=e[s];e.__esModule&&Object.defineProperty(l,"__esModule",{value:!0})})();
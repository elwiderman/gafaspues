(()=>{"use strict";var e={};function t(e){return t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},t(e)}function a(e){var a=function(e,a){if("object"!=t(e)||!e)return e;var o=e[Symbol.toPrimitive];if(void 0!==o){var i=o.call(e,a||"default");if("object"!=t(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===a?String:Number)(e)}(e,"string");return"symbol"==t(a)?a:a+""}function o(e,t){for(var o=0;o<t.length;o++){var i=t[o];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,a(i.key),i)}}function i(e,t,o){return(t=a(t))in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}const n={xhr:!1,block:function(e){e&&e.length&&void 0!==jQuery.fn.block&&(e.addClass("ajax-blocked"),e.block({message:null,overlayCSS:{background:"#fff no-repeat center",opacity:.5,cursor:"none"}}))},unblock:function(e){e&&e.hasClass("ajax-blocked")&&void 0!==jQuery.fn.block&&(e.unblock(),e.removeClass("ajax-blocked"))},call:function(e,t,a){var o=this;return a=void 0!==a?a:"GET",Array.isArray(e)?(e.push({name:"action",value:yith_wcmv_ajax.ajaxAction}),e.push({name:"security",value:yith_wcmv_ajax.ajaxNonce}),e.push({name:"context",value:"admin"})):(e.action=yith_wcmv_ajax.ajaxAction,e.security=yith_wcmv_ajax.ajaxNonce,e.context="admin"),o.block(t),o.xhr=jQuery.ajax({url:yith_wcmv_ajax.ajaxUrl,data:e,type:a}).fail((function(e){console.log(e),o.unblock(t)})).done((function(e){o.unblock(t),o.xhr=!1})),o.xhr},get:function(e,t){return this.call(e,t,"GET")},post:function(e,t){return this.call(e,t,"POST")},abort:function(){this.xhr&&this.xhr.abort()}};new(function(){return e=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),i(this,"modal",void 0),i(this,"templateHeader",void 0),i(this,"templateContent",void 0),i(this,"templateFooter",void 0),i(this,"statusChanged",void 0),this.templateHeader=wp.template("yith-wcmv-modal-commission-header"),this.templateContent=wp.template("yith-wcmv-modal-commission-content"),this.templateFooter=wp.template("yith-wcmv-modal-commission-footer"),this.init()},(t=[{key:"init",value:function(){jQuery(document).on("click",".commission-details:not(.disabled)",{self:this},this.view),jQuery(document).on("change",".commission-details-modal #commission-status",this.statusChange.bind(this)),jQuery(document).on("click",".commission-details-modal .save-commission",{self:this},this.save),jQuery(document).on("change",".enable-gateway-trigger .on_off",this.enableGateway),jQuery(document).on("submit","form.gateway-options-form",this.gatewayFormSubmit),jQuery(document).on("click",".list-item.has-options .name > *",this.gatewaySlide)}},{key:"openModal",value:function(e){return void 0===this.templateHeader||void 0===this.templateContent||void 0===this.templateFooter?(console.error("Error loading commissions templates"),!1):void 0!==e&&void(this.modal=yith.ui.modal({title:this.templateHeader(e),content:this.templateContent(e),footer:this.templateFooter(e),classes:{wrap:"commission-details-modal"}}))}},{key:"view",value:function(e){e.preventDefault();var t=e.data.self,a=jQuery(this),o=a.data("commission_id"),i=a.data("commission-data");return void 0===i?(a.addClass("disabled"),n.abort(),n.call({request:"commission_details",commission_id:o},jQuery(this).closest("td")).done((function(e){a.removeClass("disabled"),e.success&&(a.data("commission-data",e.data),t.openModal(e.data))}))):t.openModal(i),!1}},{key:"statusChange",value:function(){this.statusChanged=!0}},{key:"save",value:function(e){e.preventDefault();var t=e.data.self;if(!0===t.statusChanged){var a=jQuery('[name="commission-status"]').val(),o=jQuery(this).attr("data-commission_id");n.post({request:"commission_change_status",commission_id:o,status:a},jQuery(".commission-details-modal .yith-plugin-fw__modal__main")).done((function(e){window.location.reload()}))}else t.modal.close()}},{key:"enableGateway",value:function(e){e.preventDefault();var t=jQuery(this),a=t.is(":checked");return t.attr("disabled","disabled"),n.call({request:"switch_gateway_enabled",gateway_id:t.data("gateway_id"),gateway_enabled:a?"yes":"no"},t.closest(".list-item")).done((function(e){t.removeAttr("disabled"),e.success||t.prop("checked",!a)})),!1}},{key:"gatewayFormSubmit",value:function(e){e.preventDefault();var t=jQuery(this).serializeArray();return t.push({name:"request",value:"save_gateway_options"}),n.call(t,jQuery(this).closest(".list-item"),"POST"),!1}},{key:"gatewaySlide",value:function(e){var t=jQuery(this).closest(".list-item");t.toggleClass("opened"),t.find(".options").slideToggle()}}])&&o(e.prototype,t),a&&o(e,a),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,a}());var s=window;for(var r in e)s[r]=e[r];e.__esModule&&Object.defineProperty(s,"__esModule",{value:!0})})();